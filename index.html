<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Roleta de Sorteio</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* BotÃ£o no canto esquerdo */
    #btnLeft {
      position: fixed;
      top: 20px;
      left: 20px;
      padding: 10px 14px;
      background: #1976d2;
      color: #fff;
      text-decoration: none;
      border-radius: 8px;
      font-size: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      z-index: 9999;
    }
  </style>
</head>
<body>

<a id="btnLeft" href="index2.html">Roleta 2</a>

<div class="layout">
  <div class="painel">
    <h1>Roleta de Sorteio</h1>

    <div class="controls">
      <select id="modoCor">
      <option value="colorido" selected>ğŸ³â€ğŸŒˆ cores do vale</option>
      <option value="neutro">âšª cores Neutras</option>
      </select>
      <input id="nome" type="text" placeholder="Digite um nome">
      <input id="quantidade" type="number" min="1" value="1" style="width:80px;">
      <button id="btnAdicionar">Adicionar</button>
      <input id="tempo" type="number" min="1" placeholder="Tempo (seg)" style="width:110px;">
      <button id="btnIniciar" style="background-color:#43a047;color:#fff;">Iniciar</button>
      <button id="btnParar" style="background-color:#e53935;color:#fff;">Parar</button>
    </div>

    <div class="extras">
      <input type="file" id="inputCSV" accept=".csv" style="display:none;">
      <button id="btnImportar">ğŸ“¥ Importar CSV</button>

      <select id="colunaCSV">
        <option value="0">Coluna 1</option>
        <option value="1" selected>Coluna 2</option>
        <option value="2">Coluna 3</option>
        <option value="3">Coluna 4</option>
      </select>

      <button id="btnExportar">ğŸ“¤ Exportar CSV</button>
      <button id="btnFullscreen">ğŸ–¥ï¸ Tela Cheia</button>
      <button id="btnLimpar">ğŸ§¹ Limpar Tudo</button>

      <button class="musica" id="btnMusica">ğŸµ Tocar MÃºsica</button>

      <label style="display:flex;align-items:center;gap:6px;color:#ccc;">
        ğŸ”Š
        <input type="range" id="volumeMusica" min="0" max="100" value="50" style="width:100px;">
      </label>
    </div>

    <div id="ultimosVencedores">
      <strong>ğŸ† Ãšltimos Vencedores</strong>
      <div id="listaVencedores"></div>
      <button id="btnLimparVencedores" style="margin-top:8px;background:#e53935;color:#fff;height:35px;">ğŸ—‘ï¸ Limpar Vencedores</button>
    </div>

    <div id="listaNomes"></div>
  </div>

  <div id="container">
    <div class="seta"></div>
    <canvas id="roleta"></canvas>
    <div id="resultadoOverlay"></div>
  </div>
</div>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
  // CONFIGURE AQUI: substitua pelo URL do seu server
  const SERVER_URL = "http://localhost:3000"; // <-- trocar para seu servidor

  const socket = io(SERVER_URL, { autoConnect: true });

  socket.on('connect', () => {
    console.log('Socket conectado (roleta):', socket.id);
    // identificar a aba como roleta
    socket.emit('identify', { role: 'roleta' });
  });

  socket.on('comando', (data) => {
    console.log('Comando remoto recebido:', data);
    if(!data || !data.acao) return;

    // aÃ§Ãµes mapeadas para sua roleta
    switch(data.acao){
      case 'iniciar':
      case 'start':
        if(typeof girar === 'function') girar();
        break;
      case 'parar':
      case 'stop':
        if(typeof suave === 'function') suave();
        break;
      case 'add':
        if(data.nome){
          nomes.push(data.nome);
          cores.push(corAleatoria());
          salvar(); desenhar(); atualizar();
        }
        break;
      case 'limpar':
        if(typeof limpar === 'function') limpar();
        break;
      case 'tempo':
        if(typeof tempo !== 'undefined' && data.valor){
          // tempo Ã© input HTML; set value e guarda
          document.getElementById('tempo').value = data.valor;
        }
        break;
      case 'setNomes':
        if(Array.isArray(data.nomes)){
          nomes = data.nomes.slice();
          // gera cores correspondentes
          cores = nomes.map(()=>corAleatoria());
          salvar(); desenhar(); atualizar();
        }
        break;
      case 'setCores':
        if(Array.isArray(data.cores) && data.cores.length === nomes.length){
          cores = data.cores;
          salvar(); desenhar();
        }
        break;
      // adicione mais comandos customizados aqui
      default:
        console.log('Comando desconhecido:', data);
    }
  });

  socket.on('disconnect', () => console.log('Socket desconectado (roleta)'));
</script>

<script src="script.js"></script>

</body>
</html>
